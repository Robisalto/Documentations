<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Frédéric KIBANZA" />
  <meta name="dcterms.date" content="2021-07-12" />
  <title>POEI DevOps - AWS</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="styleDark.css" />
  
</head>
<body>
<header id="title-block-header">
<h1 class="title">POEI DevOps - AWS</h1>
<p class="author">Frédéric KIBANZA</p>
<p class="date">2021-07-12</p>
</header>
<nav id="TOC">
<ul>
<li><a href="#doc-source">Doc Source</a><ul>
<li><a href="#doc-formation">Doc Formation</a></li>
<li><a href="#docs-amazon">Docs Amazon</a></li>
</ul></li>
<li><a href="#notions">Notions</a><ul>
<li><a href="#différents-types-de-cloud">Différents types de Cloud</a></li>
</ul></li>
<li><a href="#liste-des-services">Liste des Services</a><ul>
<li><a href="#ressources-aws">Ressources AWS</a></li>
</ul></li>
<li><a href="#tp-qwiklabs">TP Qwiklabs</a><ul>
<li><a href="#tp-1">TP-1</a></li>
<li><a href="#tp-2">TP-2</a><ul>
<li><a href="#aws-windows-server">AWS &amp; Windows Server</a></li>
</ul></li>
<li><a href="#tp-3">TP-3</a><ul>
<li><a href="#additional-resources">Additional Resources</a></li>
</ul></li>
<li><a href="#tp-4">TP-4</a></li>
<li><a href="#tp-5">TP-5</a></li>
</ul></li>
<li><a href="#liens-utiles">Liens utiles</a></li>
</ul>
</nav>
<link rel="icon" href="favicon.png" type="image/png" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<h4 id="amazon-web-services">Amazon Web Services</h4>
<p><strong>Frédéric KIBANZA</strong> / Formateur Systèmes et Réseaux</p>
<p>Tél: 09.72.37.73.73 / Mail: <a href="mailto:fkibanza@dawan.fr" class="email">fkibanza@dawan.fr</a></p>
<p><a href="http://www.dawan.fr" class="uri">http://www.dawan.fr</a></p>
<p>Découvrez notre webTV : <a href="http://www.dawan.tv" class="uri">http://www.dawan.tv</a></p>
<h1 id="doc-source">Doc Source</h1>
<h2 id="doc-formation">Doc Formation</h2>
<iframe src="2021-07-12-POEI-AWS/Frederic_Kibanza_Support_AWS_Init.pdf" allowfullscreen="yes" class="iframe" scrolling="no" frameborder="0">
</iframe>
<h2 id="docs-amazon">Docs Amazon</h2>
<ul>
<li><p>Qu’est-ce que AWS: <a href="https://aws.amazon.com/fr/what-is-aws/" class="uri">https://aws.amazon.com/fr/what-is-aws/</a></p></li>
<li><p>AWS Well-Achitected Framework: <a href="https://docs.aws.amazon.com/wellarchitected/latest/framework/wellarchitected-framework.pdf" class="uri">https://docs.aws.amazon.com/wellarchitected/latest/framework/wellarchitected-framework.pdf</a></p></li>
<li><p>YouTube Channel: <a href="https://www.youtube.com/user/AmazonWebServices" class="uri">https://www.youtube.com/user/AmazonWebServices</a></p></li>
</ul>
<h1 id="notions">Notions</h1>
<h2 id="différents-types-de-cloud">Différents types de Cloud</h2>
<p><a href="https://www.redhat.com/fr/topics/cloud-computing/iaas-vs-paas-vs-saas" class="uri">https://www.redhat.com/fr/topics/cloud-computing/iaas-vs-paas-vs-saas</a></p>
<h1 id="liste-des-services">Liste des Services</h1>
<p>Liste des services AWS:</p>
<ul>
<li><strong>Amazon Elastic Compute Cloud</strong> (<strong><em>EC2</em></strong>), fournissant des serveurs virtuels évolutifs utilisant Xen.</li>
<li>Amazon <strong>Elastic Block Store</strong> (<strong><em>EBS</em></strong>), fournissant un niveau de blocs persistants pour les volumes de stockage EC2.</li>
<li>Amazon <strong>Simple Storage Service</strong> (<strong><em>S3</em></strong>), fournissant un stockage basé sur les services web.</li>
<li>Amazon <strong>Simple Queue Service</strong> (<strong><em>SQS</em></strong>), fournissant une file de messages hébergé pour les applications web.</li>
<li>Amazon <strong>Simple Email Service</strong> (<strong><em>SES</em></strong>), service d’envoi en nombre et transactionnel d’emails.</li>
<li>Amazon <strong>Mechanical Turk</strong> (Mturk), gérant des petites unités de travail distribué à de nombreuses personnes.</li>
<li><strong>Alexa Web Services</strong>, fournissant des données de trafic, des vignettes et d’autres informations à propos des sites web.</li>
<li>Amazon <strong>Associates Web Service</strong> (<strong><em>A2S</em></strong>, anciennement Amazon E-Commerce Service ou ECS), fournissant un accès aux données produit d’Amazon et des données de commerce électronique.</li>
<li>Amazon <strong>Historical Pricing</strong>, fournissant un accès à l’historique des prix d’Amazon pour ses affiliés.</li>
<li>Amazon <strong>Flexible Payments Service</strong> (FPS), actuellement en beta fermée, fournissant une interface pour le micropaiement.</li>
<li>Amazon <strong>DevPay</strong>, actuellement en beta fermée, est un système de facturation et de gestion de comptes pour les applications que les développeurs ont conçu avec les Amazon Web Services.</li>
<li>Amazon <strong>SimpleDB</strong>, actuellement en beta fermée, permet aux développeurs d’exécuter des requêtes sur des données structurées. Il fonctionne de concert avec AC2 et S3 pour fournir “les fonctionnalités d’un noyau de base de données”</li>
<li>Amazon <strong>AWS Authentication</strong> est un service implicite, l’infrastructure d’autentification utilisée pour authentifier l’accès aux différents services.</li>
<li>Amazon <strong>Fulfillment Web</strong> Service fournit une API pour les vendeurs pour expédier des articles vers et depuis Amazon.</li>
<li>Amazon <strong>CloudFront</strong>, un Content Delivery Network (CDN) pour distribuer des objets stockés sur S3 vers un emplacement proche de l’appelant.</li>
<li><strong>AWS Management Console</strong> (AWS Console), est une interface point and click basé sur le web pour gérer et surveiller les infrastructures Amazon, incluant EC2, EBS, S3, and SQS.</li>
</ul>
<h2 id="ressources-aws">Ressources AWS</h2>
<ul>
<li><a href="https://aws.amazon.com/fr/ec2/?ec2-whats-new.sort-by=item.additionalFields.postDateTime&amp;ec2-whats-new.sort-order=desc">Amazon EC2</a></li>
</ul>
<p>For more information about AWS Training &amp; Certification, see: <a href="http://aws.amazon.com/training/" class="uri">http://aws.amazon.com/training/</a></p>
<h1 id="tp-qwiklabs">TP Qwiklabs</h1>
<h2 id="tp-1">TP-1</h2>
<p>TP-1: <a href="https://www.qwiklabs.com/focuses/16438?catalog_rank=%7B%22rank%22%3A2%2C%22num_filters%22%3A0%2C%22has_search%22%3Atrue%7D&amp;parent=catalog&amp;search_id=10984620">Introduction à Amazon Simple Storage Service (S3)</a></p>
<h2 id="tp-2">TP-2</h2>
<p>TP-2: <a href="https://www.qwiklabs.com/focuses/18123?catalog_rank=%7B%22rank%22%3A2%2C%22num_filters%22%3A0%2C%22has_search%22%3Atrue%7D&amp;parent=catalog&amp;search_id=11911521">Introduction to AWS Identity and Access Management (IAM)</a></p>
<h3 id="aws-windows-server">AWS &amp; Windows Server</h3>
<p>By creating <strong>IAM</strong> roles and <strong>AD FS Groups</strong>, you are able to assign specific permissions to users to limit their access to appropriate parts of the AWS Management Console.</p>
<p>For reference, see the followingdetailed blog article on this topic (with Windows Server 2008 R2):</p>
<p><a href="https://blogs.aws.amazon.com/security/post/Tx71TWXXJ3UI14/Enabling-Federation-to-AWS-using-Windows-Active-Directory-ADFS-and-SAML-2-0" class="uri">https://blogs.aws.amazon.com/security/post/Tx71TWXXJ3UI14/Enabling-Federation-to-AWS-using-Windows-Active-Directory-ADFS-and-SAML-2-0</a></p>
<h2 id="tp-3">TP-3</h2>
<p>TP-3: <a href="https://www.qwiklabs.com/focuses/17876?catalog_rank=%7B%22rank%22%3A3%2C%22num_filters%22%3A0%2C%22has_search%22%3Atrue%7D&amp;parent=catalog&amp;search_id=11947373">Introduction to Amazon EC2</a></p>
<h3 id="additional-resources">Additional Resources</h3>
<ul>
<li><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/LaunchingAndUsingInstances.html">Launch your instance</a></li>
<li><a href="https://aws.amazon.com/ec2/instance-types">Amazon EC2 Instance Types</a></li>
<li><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AMIs.html">Amazon Machine Images (AMI)</a></li>
<li><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/user-data.html">Amazon EC2 - User Data and Shell Scripts</a></li>
<li><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/RootDeviceStorage.html">Amazon EC2 Root Device Volume</a></li>
<li><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/Using_Tags.html">Tagging your Amazon EC2 Resources</a></li>
<li><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-network-security.html">Security Groups</a></li>
<li><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-key-pairs.html">Amazon EC2 KeyPairs</a></li>
<li><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/monitoring-system-instance-status-check.html?icmpid=docs_ec2_console">Status Check for your Instances</a></li>
<li><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/instance-console.html">Getting Console Output and Rebooting Instances</a></li>
<li><a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/ec2-metricscollected.html">Amazon EC2 Metrics and Dimensions</a></li>
<li><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-resize.html">Resizing Your Instance</a></li>
<li><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/Stop_Start.html">Stop and Start Your Instance</a></li>
<li><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-resource-limits.htm">Amazon EC2 Service Limits</a></li>
<li><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/terminating-instances.html">Terminate Your Instance</a></li>
<li><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/terminating-instances.html">Termination Protection for an Instance</a></li>
</ul>
<h2 id="tp-4">TP-4</h2>
<p><a href="https://www.qwiklabs.com/focuses/15485?catalog_rank=%7B%22rank%22%3A3%2C%22num_filters%22%3A0%2C%22has_search%22%3Atrue%7D&amp;parent=catalog&amp;search_id=11948000">Automating AWS Services with Scripting and the AWS CLI</a></p>
<h4 id="création-de-clé">Création de clé</h4>
<p>Script Python pour créer des clés SSH:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb1-1" title="1"><span class="co">#!/usr/bin/env python</span></a>
<a class="sourceLine" id="cb1-2" title="2"></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="im">import</span> boto3</a>
<a class="sourceLine" id="cb1-4" title="4"></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="co"># Connect to the Amazon EC2 service</span></a>
<a class="sourceLine" id="cb1-6" title="6">ec2_client <span class="op">=</span> boto3.client(<span class="st">&#39;ec2&#39;</span>)</a>
<a class="sourceLine" id="cb1-7" title="7"></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="co"># Create a Key Pair</span></a>
<a class="sourceLine" id="cb1-9" title="9">key <span class="op">=</span> ec2_client.create_key_pair(KeyName <span class="op">=</span> <span class="st">&#39;SDK&#39;</span>)</a>
<a class="sourceLine" id="cb1-10" title="10"></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="co"># Print the private Fingerprint of the private key</span></a>
<a class="sourceLine" id="cb1-12" title="12"><span class="bu">print</span>(key.get(<span class="st">&#39;KeyFingerprint&#39;</span>))</a></code></pre></div>
<p>Cleanup Key pairs:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb2-1" title="1"><span class="co">#!/usr/bin/env python</span></a>
<a class="sourceLine" id="cb2-2" title="2"></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="im">import</span> boto3</a>
<a class="sourceLine" id="cb2-4" title="4"></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="co"># Connect to the Amazon EC2 service</span></a>
<a class="sourceLine" id="cb2-6" title="6">ec2_client <span class="op">=</span> boto3.client(<span class="st">&#39;ec2&#39;</span>)</a>
<a class="sourceLine" id="cb2-7" title="7"></a>
<a class="sourceLine" id="cb2-8" title="8">keypairs <span class="op">=</span> ec2_client.describe_key_pairs()</a>
<a class="sourceLine" id="cb2-9" title="9"></a>
<a class="sourceLine" id="cb2-10" title="10"><span class="cf">for</span> key <span class="kw">in</span> keypairs[<span class="st">&#39;KeyPairs&#39;</span>]:</a>
<a class="sourceLine" id="cb2-11" title="11">  <span class="cf">if</span> <span class="st">&#39;lab&#39;</span> <span class="kw">not</span> <span class="kw">in</span> key[<span class="st">&#39;KeyName&#39;</span>].lower():</a>
<a class="sourceLine" id="cb2-12" title="12">    <span class="bu">print</span> <span class="st">&quot;Deleting key pair&quot;</span>, key[<span class="st">&#39;KeyName&#39;</span>]</a>
<a class="sourceLine" id="cb2-13" title="13">    ec2_client.delete_key_pair(KeyName<span class="op">=</span>key[<span class="st">&#39;KeyName&#39;</span>])</a></code></pre></div>
<h4 id="snapshots">Snapshots</h4>
<p>snapshotter.py:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb3-1" title="1"><span class="co">#!/usr/bin/env python</span></a>
<a class="sourceLine" id="cb3-2" title="2"></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="im">import</span> boto3</a>
<a class="sourceLine" id="cb3-4" title="4"><span class="im">import</span> datetime</a>
<a class="sourceLine" id="cb3-5" title="5"></a>
<a class="sourceLine" id="cb3-6" title="6">MAX_SNAPSHOTS <span class="op">=</span> <span class="dv">2</span>   <span class="co"># Number of snapshots to keep</span></a>
<a class="sourceLine" id="cb3-7" title="7"></a>
<a class="sourceLine" id="cb3-8" title="8"><span class="co"># Connect to the Amazon EC2 service</span></a>
<a class="sourceLine" id="cb3-9" title="9">ec2 <span class="op">=</span> boto3.resource(<span class="st">&#39;ec2&#39;</span>)</a>
<a class="sourceLine" id="cb3-10" title="10"></a>
<a class="sourceLine" id="cb3-11" title="11"><span class="co"># Loop through each volume</span></a>
<a class="sourceLine" id="cb3-12" title="12"><span class="cf">for</span> volume <span class="kw">in</span> ec2.volumes.<span class="bu">all</span>():</a>
<a class="sourceLine" id="cb3-13" title="13"></a>
<a class="sourceLine" id="cb3-14" title="14">  <span class="co"># Create a snapshot of the volume with the current time as a Description</span></a>
<a class="sourceLine" id="cb3-15" title="15">  new_snapshot <span class="op">=</span> volume.create_snapshot(Description <span class="op">=</span> <span class="bu">str</span>(datetime.datetime.now()))</a>
<a class="sourceLine" id="cb3-16" title="16">  <span class="bu">print</span> (<span class="st">&quot;Created snapshot &quot;</span> <span class="op">+</span> new_snapshot.<span class="bu">id</span>)</a>
<a class="sourceLine" id="cb3-17" title="17"></a>
<a class="sourceLine" id="cb3-18" title="18">  <span class="co"># Too many snapshots?</span></a>
<a class="sourceLine" id="cb3-19" title="19">  snapshots <span class="op">=</span> <span class="bu">list</span>(volume.snapshots.<span class="bu">all</span>())</a>
<a class="sourceLine" id="cb3-20" title="20">  <span class="cf">if</span> <span class="bu">len</span>(snapshots) <span class="op">&gt;</span> MAX_SNAPSHOTS:</a>
<a class="sourceLine" id="cb3-21" title="21"></a>
<a class="sourceLine" id="cb3-22" title="22">    <span class="co"># Delete oldest snapshots, but keep MAX_SNAPSHOTS available</span></a>
<a class="sourceLine" id="cb3-23" title="23">    snapshots_sorted <span class="op">=</span> <span class="bu">sorted</span>([(s, s.start_time) <span class="cf">for</span> s <span class="kw">in</span> snapshots], key<span class="op">=</span><span class="kw">lambda</span> k: k[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb3-24" title="24">    <span class="cf">for</span> snapshot <span class="kw">in</span> snapshots_sorted[:<span class="op">-</span>MAX_SNAPSHOTS]:</a>
<a class="sourceLine" id="cb3-25" title="25">      <span class="bu">print</span> (<span class="st">&quot;Deleted snapshot &quot;</span> <span class="op">+</span> snapshot[<span class="dv">0</span>].<span class="bu">id</span>)</a>
<a class="sourceLine" id="cb3-26" title="26">      snapshot[<span class="dv">0</span>].delete()</a></code></pre></div>
<h4 id="bastion">Bastion</h4>
<p>Give access to specific IP to security group:</p>
<pre class="shell"><code>aws ec2 authorize-security-group-ingress --group-id $SECURITY_GROUP_ID --protocol tcp --port 22 --cidr 92.138.170.139/32
</code></pre>
<p>Revoke access:</p>
<pre class="shell"><code>aws ec2 revoke-security-group-ingress --group-id $SECURITY_GROUP_ID --protocol tcp --port 22 --cidr 92.138.170.139/32
</code></pre>
<h5 id="avec-des-scripts">Avec des scripts:</h5>
<p>Grant access: <code>bastion-open</code></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb6-1" title="1"><span class="va">IP=</span><span class="kw">`</span><span class="ex">curl</span> -s checkip.amazonaws.com<span class="kw">`</span></a>
<a class="sourceLine" id="cb6-2" title="2"><span class="va">SECURITY_GROUP_ID=</span><span class="kw">`</span><span class="ex">aws</span> ec2 describe-security-groups --filters Name=group-name,Values=Bastion --query SecurityGroups[*].GroupId --output text<span class="kw">`</span></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="ex">aws</span> ec2 authorize-security-group-ingress --group-id <span class="va">$SECURITY_GROUP_ID</span> --protocol tcp --port 22 --cidr <span class="va">$IP</span>/32</a></code></pre></div>
<p>Revoke access: <code>bastion-close.py</code></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb7-1" title="1"><span class="co">#!/usr/bin/env python</span></a>
<a class="sourceLine" id="cb7-2" title="2"></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="im">import</span> boto3</a>
<a class="sourceLine" id="cb7-4" title="4"></a>
<a class="sourceLine" id="cb7-5" title="5">GROUP_NAME <span class="op">=</span> <span class="st">&quot;Bastion&quot;</span></a>
<a class="sourceLine" id="cb7-6" title="6"></a>
<a class="sourceLine" id="cb7-7" title="7"><span class="co"># Connect to the Amazon EC2 service</span></a>
<a class="sourceLine" id="cb7-8" title="8">ec2 <span class="op">=</span> boto3.resource(<span class="st">&#39;ec2&#39;</span>)</a>
<a class="sourceLine" id="cb7-9" title="9"></a>
<a class="sourceLine" id="cb7-10" title="10"><span class="co"># Retrieve the security group</span></a>
<a class="sourceLine" id="cb7-11" title="11">security_groups <span class="op">=</span> ec2.security_groups.<span class="bu">filter</span>(Filters<span class="op">=</span>[{<span class="st">&#39;Name&#39;</span>:<span class="st">&#39;group-name&#39;</span>, <span class="st">&#39;Values&#39;</span>:[<span class="st">&#39;Bastion&#39;</span>]}])</a>
<a class="sourceLine" id="cb7-12" title="12"></a>
<a class="sourceLine" id="cb7-13" title="13"><span class="co"># Delete all rules in the group</span></a>
<a class="sourceLine" id="cb7-14" title="14"><span class="cf">for</span> group <span class="kw">in</span> security_groups:</a>
<a class="sourceLine" id="cb7-15" title="15">    group.revoke_ingress(IpPermissions <span class="op">=</span> group.ip_permissions)</a></code></pre></div>
<h4 id="the-stopinator">The Stopinator</h4>
<p>The Stopinator is a simple Linux script that turns off Amazon EC2 Instances.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb8-1" title="1"><span class="co">#!/usr/bin/env python</span></a>
<a class="sourceLine" id="cb8-2" title="2"></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="im">import</span> boto3</a>
<a class="sourceLine" id="cb8-4" title="4"></a>
<a class="sourceLine" id="cb8-5" title="5"><span class="co"># Connect to the Amazon EC2 service</span></a>
<a class="sourceLine" id="cb8-6" title="6">ec2 <span class="op">=</span> boto3.resource(<span class="st">&#39;ec2&#39;</span>)</a>
<a class="sourceLine" id="cb8-7" title="7"></a>
<a class="sourceLine" id="cb8-8" title="8"><span class="co"># Loop through each instance</span></a>
<a class="sourceLine" id="cb8-9" title="9"><span class="cf">for</span> instance <span class="kw">in</span> ec2.instances.<span class="bu">all</span>():</a>
<a class="sourceLine" id="cb8-10" title="10">  state <span class="op">=</span> instance.state[<span class="st">&#39;Name&#39;</span>]</a>
<a class="sourceLine" id="cb8-11" title="11">  <span class="cf">for</span> tag <span class="kw">in</span> instance.tags:</a>
<a class="sourceLine" id="cb8-12" title="12"></a>
<a class="sourceLine" id="cb8-13" title="13">    <span class="co"># Check for the &#39;stopinator&#39; tag</span></a>
<a class="sourceLine" id="cb8-14" title="14">    <span class="cf">if</span> tag[<span class="st">&#39;Key&#39;</span>] <span class="op">==</span> <span class="st">&#39;stopinator&#39;</span>:</a>
<a class="sourceLine" id="cb8-15" title="15">      action <span class="op">=</span> tag[<span class="st">&#39;Value&#39;</span>].lower()</a>
<a class="sourceLine" id="cb8-16" title="16"></a>
<a class="sourceLine" id="cb8-17" title="17">      <span class="co"># Stop?</span></a>
<a class="sourceLine" id="cb8-18" title="18">      <span class="cf">if</span> action <span class="op">==</span> <span class="st">&#39;stop&#39;</span> <span class="kw">and</span> state <span class="op">==</span> <span class="st">&#39;running&#39;</span>:</a>
<a class="sourceLine" id="cb8-19" title="19">        <span class="bu">print</span> <span class="st">&quot;Stopping instance&quot;</span>, instance.<span class="bu">id</span></a>
<a class="sourceLine" id="cb8-20" title="20">        instance.stop()</a>
<a class="sourceLine" id="cb8-21" title="21"></a>
<a class="sourceLine" id="cb8-22" title="22">      <span class="co"># Terminate?</span></a>
<a class="sourceLine" id="cb8-23" title="23">      <span class="cf">elif</span> action <span class="op">==</span> <span class="st">&#39;terminate&#39;</span> <span class="kw">and</span> state <span class="op">!=</span> <span class="st">&#39;terminated&#39;</span>:</a>
<a class="sourceLine" id="cb8-24" title="24">        <span class="bu">print</span> <span class="st">&quot;Terminating instance&quot;</span>, instance.<span class="bu">id</span></a>
<a class="sourceLine" id="cb8-25" title="25">        instance.terminate()</a></code></pre></div>
<p>Pour que le <code>stopinator</code> fonctionne, les instances doivent avoir le <strong>tag</strong>: <strong><em>stopinator</em></strong>.</p>
<p>Tag confgiguration:</p>
<ul>
<li>Key: stopinator</li>
<li>Value: stop|terminate</li>
</ul>
<h4 id="highlow-game">HighLow Game</h4>
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb9-1" title="1"><span class="co">#!/usr/bin/env python</span></a>
<a class="sourceLine" id="cb9-2" title="2"></a>
<a class="sourceLine" id="cb9-3" title="3"><span class="im">import</span> random, time, sys</a>
<a class="sourceLine" id="cb9-4" title="4"><span class="im">import</span> boto3</a>
<a class="sourceLine" id="cb9-5" title="5"></a>
<a class="sourceLine" id="cb9-6" title="6"><span class="co"># Connect to the Amazon EC2 service</span></a>
<a class="sourceLine" id="cb9-7" title="7">cloudwatch_client <span class="op">=</span> boto3.client(<span class="st">&#39;cloudwatch&#39;</span>)</a>
<a class="sourceLine" id="cb9-8" title="8"></a>
<a class="sourceLine" id="cb9-9" title="9"><span class="co"># Let them guess</span></a>
<a class="sourceLine" id="cb9-10" title="10">count <span class="op">=</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb9-11" title="11"><span class="cf">while</span> <span class="va">True</span>:</a>
<a class="sourceLine" id="cb9-12" title="12"></a>
<a class="sourceLine" id="cb9-13" title="13">  <span class="co"># Start of game?</span></a>
<a class="sourceLine" id="cb9-14" title="14">  <span class="cf">if</span> count <span class="op">==</span> <span class="dv">0</span>:</a>
<a class="sourceLine" id="cb9-15" title="15">    start_time <span class="op">=</span> time.time()</a>
<a class="sourceLine" id="cb9-16" title="16">    num <span class="op">=</span> random.randint(<span class="dv">1</span>, <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb9-17" title="17">    <span class="bu">print</span> <span class="st">&quot;I&#39;m thinking of a number from 1 to 100. Try to guess it! (Enter 0 to exit)&quot;</span></a>
<a class="sourceLine" id="cb9-18" title="18"></a>
<a class="sourceLine" id="cb9-19" title="19">  <span class="co"># Guess a number</span></a>
<a class="sourceLine" id="cb9-20" title="20">  guess <span class="op">=</span> <span class="bu">input</span>(<span class="st">&quot;&gt; &quot;</span>)</a>
<a class="sourceLine" id="cb9-21" title="21">  count <span class="op">+=</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb9-22" title="22"></a>
<a class="sourceLine" id="cb9-23" title="23">  <span class="co"># Respond</span></a>
<a class="sourceLine" id="cb9-24" title="24">  <span class="cf">if</span> guess <span class="op">==</span> <span class="dv">0</span>:</a>
<a class="sourceLine" id="cb9-25" title="25">    <span class="co"># End game</span></a>
<a class="sourceLine" id="cb9-26" title="26">    sys.exit()</a>
<a class="sourceLine" id="cb9-27" title="27">  <span class="cf">elif</span> guess <span class="op">&lt;</span> num:</a>
<a class="sourceLine" id="cb9-28" title="28">    <span class="bu">print</span> <span class="st">&quot;Too low!&quot;</span></a>
<a class="sourceLine" id="cb9-29" title="29">  <span class="cf">elif</span> guess <span class="op">&gt;</span> num:</a>
<a class="sourceLine" id="cb9-30" title="30">    <span class="bu">print</span> <span class="st">&quot;Too high!&quot;</span></a>
<a class="sourceLine" id="cb9-31" title="31">  <span class="cf">else</span>:</a>
<a class="sourceLine" id="cb9-32" title="32">    <span class="co"># Correct answer</span></a>
<a class="sourceLine" id="cb9-33" title="33">    seconds <span class="op">=</span> <span class="bu">int</span>(time.time() <span class="op">-</span> start_time)</a>
<a class="sourceLine" id="cb9-34" title="34">    <span class="bu">print</span> <span class="st">&quot;That&#39;s correct! It took you </span><span class="sc">%d</span><span class="st"> guesses and </span><span class="sc">%d</span><span class="st"> seconds.</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">%</span> (count, seconds)</a>
<a class="sourceLine" id="cb9-35" title="35"></a>
<a class="sourceLine" id="cb9-36" title="36">    <span class="co"># Push metric to CloudWatch</span></a>
<a class="sourceLine" id="cb9-37" title="37">    cloudwatch_client.put_metric_data(Namespace<span class="op">=</span><span class="st">&quot;Lab&quot;</span>, MetricData<span class="op">=</span>[{<span class="st">&#39;MetricName&#39;</span>:<span class="st">&#39;highlow&#39;</span>, <span class="st">&#39;Value&#39;</span>:seconds}])</a>
<a class="sourceLine" id="cb9-38" title="38">    <span class="bu">print</span> <span class="st">&quot;The metric has been sent to CloudWatch.</span><span class="ch">\n</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb9-39" title="39"></a>
<a class="sourceLine" id="cb9-40" title="40">    <span class="co"># Start again</span></a>
<a class="sourceLine" id="cb9-41" title="41">    count <span class="op">=</span> <span class="dv">0</span></a></code></pre></div>
<h4 id="accessing-helpdoc">Accessing Help&amp;Doc</h4>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb10-1" title="1"><span class="ex">aws</span> help</a>
<a class="sourceLine" id="cb10-2" title="2"></a>
<a class="sourceLine" id="cb10-3" title="3"><span class="ex">aws</span> ec2 help</a>
<a class="sourceLine" id="cb10-4" title="4"></a>
<a class="sourceLine" id="cb10-5" title="5"><span class="ex">aws</span> ec2 describe-instances help</a></code></pre></div>
<p>The complete documentation for the AWS CLi is available at: <a href="https://boto3.amazonaws.com/v1/documentation/api/latest/index.html#">boto3 Documentation</a></p>
<h4 id="additional-resources-1">Additional Resources</h4>
<p>For more information about the AWS CLI, see: <a href="http://aws.amazon.com/cli" class="uri">http://aws.amazon.com/cli</a></p>
<h2 id="tp-5">TP-5</h2>
<p><a href="https://www.qwiklabs.com/focuses/17968?catalog_rank=%7B%22rank%22%3A2%2C%22num_filters%22%3A0%2C%22has_search%22%3Atrue%7D&amp;parent=catalog&amp;search_id=11948000">Introduction to Amazon Elastic Block Store (Amazon EBS)</a></p>
<h1 id="liens-utiles">Liens utiles</h1>
<ul>
<li><p><a href="https://www.cnil.fr/fr/la-protection-des-donnees-dans-le-monde" class="uri">https://www.cnil.fr/fr/la-protection-des-donnees-dans-le-monde</a></p></li>
<li><p><a href="https://www.submarinecablemap.com/" class="uri">https://www.submarinecablemap.com/</a></p></li>
</ul>
<meta name="viewport" content="width=device-width, initial-scale=1.0">



<div class="footer" id="bottom">
  <p> *** <a href="#top">Top / Début</a> - <a href="Index_des_Documentations.html">Index des Documentations</a> - <a href="#bottom">Bottom / Fin</a> *** </p>
</div>
</body>
</html>
