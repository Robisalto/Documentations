<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="David DEBRAY" />
  <meta name="dcterms.date" content="2021-08-11" />
  <title>POEI DevOps - Prometheus</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="styleDark.css" />
  
</head>
<body>
<header id="title-block-header">
<h1 class="title">POEI DevOps - Prometheus</h1>
<p class="author">David DEBRAY</p>
<p class="date">2021-08-11</p>
</header>
<nav id="TOC">
<ul>
<li><a href="#site-officiel">Site Officiel</a></li>
<li><a href="#doc-source">Doc Source</a><ul>
<li><a href="#présentation-de-prometheus">Présentation de <strong>Prometheus</strong></a><ul>
<li><a href="#fonctionnement-de-prometheus">Fonctionnement de Prometheus</a></li>
<li><a href="#décomposition-réseau">Décomposition réseau</a></li>
<li><a href="#petit-qcm-notions-de-base">Petit QCM <em>(Notions de base)</em></a></li>
<li><a href="#les-types-de-données">Les Types de Données</a></li>
</ul></li>
</ul></li>
<li><a href="#tips-tricks"><em>Tips &amp; Tricks</em></a><ul>
<li><a href="#documentations-réseau">Documentations réseau</a></li>
</ul></li>
</ul>
</nav>
<link rel="icon" href="favicon.png" type="image/png" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<hr />
<h4 id="introduction">Introduction</h4>
<p>Formateur: <strong>Alexandre Chaussier</strong></p>
<ul>
<li>Mail: <a href="mailto:a.chaussier@infopen.pro" class="email">a.chaussier@infopen.pro</a></li>
<li>Tél: <a href="06.63.73.54.92">06.63.73.54.92</a></li>
</ul>
<p>2e partie de 3 formations:</p>
<ul>
<li>Terraform</li>
<li><strong>Prometheus &amp; Graphana</strong></li>
<li>ELK Stack</li>
</ul>
<hr />
<h1 id="site-officiel">Site Officiel</h1>
<p><img src="http://blog.inkubate.io/content/images/2017/12/prometheus-logo-3.png" /></p>
<ul>
<li>Site officiel: <a href="https://prometheus.io/" class="uri">https://prometheus.io/</a></li>
<li>Documentation: <a href="https://prometheus.io/docs/introduction/overview/" class="uri">https://prometheus.io/docs/introduction/overview/</a></li>
</ul>
<h1 id="doc-source">Doc Source</h1>
<p>Documentation source: <a href="2021-08-11-POEI-Prometheus/">NOT YET IMPLEMENTED…</a></p>
<h2 id="présentation-de-prometheus">Présentation de <strong>Prometheus</strong></h2>
<iframe src="2021-08-11-POEI-Prometheus/" width="1200px" height="500px" allowfullscreen="yes">
</iframe>
<h3 id="fonctionnement-de-prometheus">Fonctionnement de Prometheus</h3>
<p><img src="2021-08-11-POEI-Prometheus/2021-08-11_12h27_37.png" /></p>
<p>Prometheus est composé des 3 grandes parties:</p>
<ol type="1">
<li><code>Prometheus</code> : collecte, stockage ou transfert, exposition, alertes</li>
<li><code>Alertmanager</code> : gestion des notifications</li>
<li><code>Pushgateway</code> : réception de métriques <em>(sonde)</em></li>
</ol>
<blockquote>
<p><strong>TSDB</strong>: Time Series DataBase, <em>“Une Time Series DataBase est une base de données optimisée pour le stockage de données horodatées, telles que les données générées par l’internet des objets. Découvrez la définition complète d’une Time Series DataBase, ses différences avec les autres bases de données, ses fonctionnalités spécifiques, ses avantages pour l’entreprise, ainsi que le classement des bases de données TimeSeries les plus populaires.”</em></p>
<p>–<a href="https://www.lebigdata.fr/time-series-database-definition" class="uri">https://www.lebigdata.fr/time-series-database-definition</a></p>
</blockquote>
<h3 id="décomposition-réseau">Décomposition réseau</h3>
<p><img src="2021-08-11-POEI-Prometheus/2021-08-11_12h40_14.png" /></p>
<p>Un serveur Prometheus de relai est placé dans la DMZ, permet de:</p>
<ul>
<li>Réduire les flux</li>
<li>Réduire temps de latence =&gt; Augmenter la réactivité :D</li>
<li>Augmenter la sécurité</li>
<li>Déployer de nouveaux services sans trop affecter la supervision en place</li>
<li>etc.</li>
</ul>
<h3 id="petit-qcm-notions-de-base">Petit QCM <em>(Notions de base)</em></h3>
<p><img src="2021-08-11-POEI-Prometheus/2021-08-11_14h43_28.png" /></p>
<h3 id="les-types-de-données">Les Types de Données</h3>
<ul>
<li><a href="https://prometheus.io/docs/concepts/metric_types/" class="uri">https://prometheus.io/docs/concepts/metric_types/</a></li>
</ul>
<p>Prometheus permet d’utiliser quatre types de données pour les métriques :</p>
<ol type="1">
<li>Le compteur (counter)</li>
<li>La jauge (gauge)</li>
<li>L’histogramme (histogram)</li>
<li>Le résumé (summary)</li>
</ol>
<h4 id="counter">Counter</h4>
<p>C’est une valeur qui ne peut qu’augmenter ou être remise à 0, dans le cas de redémarrage par exemple</p>
<p>Exemple: nombre de requêtes, d’erreurs, …</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode go"><code class="sourceCode go"><a class="sourceLine" id="cb1-1" title="1"># HELP node_softnet_processed_total Number of processed packets</a>
<a class="sourceLine" id="cb1-2" title="2"># TYPE node_softnet_processed_total counter</a>
<a class="sourceLine" id="cb1-3" title="3">node_softnet_processed_total{cpu=<span class="st">&quot;0&quot;</span>} <span class="dv">2</span><span class="fl">.40324588e+08</span></a>
<a class="sourceLine" id="cb1-4" title="4">node_softnet_processed_total{cpu=<span class="st">&quot;1&quot;</span>} <span class="dv">2</span><span class="fl">.40305375e+08</span></a>
<a class="sourceLine" id="cb1-5" title="5">node_softnet_processed_total{cpu=<span class="st">&quot;2&quot;</span>} <span class="dv">2</span><span class="fl">.38303536e+08</span></a>
<a class="sourceLine" id="cb1-6" title="6">node_softnet_processed_total{cpu=<span class="st">&quot;3&quot;</span>} <span class="dv">2</span><span class="fl">.37670081e+08</span></a></code></pre></div>
<h4 id="gauge">Gauge</h4>
<p>C’est une valeur entière qui peut être incrémentée ou décrémentée, à la différence du compteur</p>
<p>Exemple: les consommations mémoire, les températures, …</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode go"><code class="sourceCode go"><a class="sourceLine" id="cb2-1" title="1"># HELP node_entropy_available_bits Bits of available entropy.</a>
<a class="sourceLine" id="cb2-2" title="2"># TYPE node_entropy_available_bits gauge</a>
<a class="sourceLine" id="cb2-3" title="3">node_entropy_available_bits <span class="dv">3941</span></a></code></pre></div>
<h4 id="histogram">Histogram</h4>
<p>Permet de distribuer des valeurs sur un ensemble de poches.</p>
<p>Par exemple, pour connaître la répartition de requêtes par leur temps d’exécution.</p>
<p>Deux métriques sont automatiquement rajoutées en plus des poches :</p>
<ul>
<li><code>sum</code> : la somme des valeurs</li>
<li><code>count</code> : le nombre de valeurs</li>
</ul>
<p>On peut ensuite appliquer diverses fonctions.</p>
<p>Ex: le calcul de percentiles, via histogram_quantile()</p>
<h5 id="exemple">Exemple</h5>
<p>Exemple, un histogramme nommé http_request_duration_seconds :</p>
<ul>
<li>avec 5 poches ( 0.5 , 1 , 2 , 3 et 5 )</li>
<li>ayant traité 3 requêtes qui ont respectivement duré 1s , 2s , 3s</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode go"><code class="sourceCode go"><a class="sourceLine" id="cb3-1" title="1"># HELP http_request_duration_seconds Request duration histogram</a>
<a class="sourceLine" id="cb3-2" title="2"># TYPE http_request_duration_seconds histogram</a>
<a class="sourceLine" id="cb3-3" title="3">http_request_duration_seconds_bucket{le=<span class="st">&quot;0.5&quot;</span>} <span class="dv">0</span></a>
<a class="sourceLine" id="cb3-4" title="4">http_request_duration_seconds_bucket{le=<span class="st">&quot;1&quot;</span>} <span class="dv">1</span></a>
<a class="sourceLine" id="cb3-5" title="5">http_request_duration_seconds_bucket{le=<span class="st">&quot;2&quot;</span>} <span class="dv">2</span></a>
<a class="sourceLine" id="cb3-6" title="6">http_request_duration_seconds_bucket{le=<span class="st">&quot;3&quot;</span>} <span class="dv">3</span></a>
<a class="sourceLine" id="cb3-7" title="7">http_request_duration_seconds_bucket{le=<span class="st">&quot;5&quot;</span>} <span class="dv">3</span></a>
<a class="sourceLine" id="cb3-8" title="8">http_request_duration_seconds_bucket{le=<span class="st">&quot;+Inf&quot;</span>} <span class="dv">3</span></a>
<a class="sourceLine" id="cb3-9" title="9">http_request_duration_seconds_sum <span class="dv">6</span></a>
<a class="sourceLine" id="cb3-10" title="10">http_request_duration_seconds_count <span class="dv">3</span></a></code></pre></div>
<h4 id="summary-moins-utilisé-et-plus-compliqué">Summary <em>(moins utilisé et plus compliqué)</em></h4>
<p>Ce type de métrique est l’équivalent d’un appel à histogram_quantile() mais traité coté client</p>
<ul>
<li>Deux métriques, <code>sum</code> et <code>count</code> , sont automatiquement ajoutées.</li>
<li>Moins souple que l’histogramme et avec un certain nombre de limitations:</li>
<li>Pas possible d’agréger les métriques si le service est distribué</li>
<li>Besoin de connaître à l’avance les quantiles souhaités</li>
<li>Plus consommateur en ressources au niveau du client</li>
</ul>
<p>Je préconise l’utilisation des histogrammes pour ces besoins</p>
<hr />
<h1 id="tips-tricks"><em>Tips &amp; Tricks</em></h1>
<h2 id="documentations-réseau">Documentations réseau</h2>
<ul>
<li><a href="https://tls.ulfheim.net/" class="uri">https://tls.ulfheim.net/</a></li>
<li><a href="https://www.frameip.com/" class="uri">https://www.frameip.com/</a></li>
</ul>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<hr />
<h5 id="the-end" align="center">The End</h5>
<hr />

<div class="footer" id="bottom">
  <p> *** <a href="#top">Top / Début</a> - <a href="Index_des_Documentations.html">Index des Documentations</a> - <a href="#the-end">Bottom / Fin</a> *** </p>
</div>
</body>
</html>
